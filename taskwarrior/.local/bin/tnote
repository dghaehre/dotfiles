#!/usr/bin/env sh

if [[ -z "$1" ]]; then
  echo "Usage: tnote {id}"
  echo ""
  exit
fi

UUID=$(task _get "$1".uuid)
PROJECT=$(task _get "$1".project)


if [[ $PROJECT == "vipps"* ]]; then
  mkdir -p ~/wikis/work/taskwarrior-notes
  NOTE=~/wikis/work/taskwarrior-notes/$UUID.md
else
  mkdir -p ~/wikis/vimwiki/taskwarrior-notes
  NOTE=~/wikis/vimwiki/taskwarrior-notes/$UUID.md
fi

if [ ! -f "$NOTE" ]; then # If file does not exist
  desc=$(task _get "$1".description)
  echo "# $desc" >> $NOTE
fi

$EDITOR "$NOTE"

if [ -f "$NOTE" ]; then # File exist

  LINES=$(wc -l "$NOTE" | awk '{print $1;}')
  if [ "$LINES" -ge 10 ]; then
    task $UUID mod note:l
  else
    task $UUID mod note:s
  fi

else
  task $UUID mod note:
fi

