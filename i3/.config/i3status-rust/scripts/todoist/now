#!/usr/bin/env bash

# TODO:
# - [ ] handle multiple tasks labeled as @now

token=$(cat ~/.todoist.token)

n=$(curl -s -X GET  "https://api.todoist.com/rest/v1/tasks?filter=@now"  -H "Authorization: Bearer $token" | jq '.[0].content')

if [[ "$n" == "null" || "$n" == "parse error:"* ]]; then
  echo "{\"icon\":\"headphones\", \"text\": \"\", \"state\": \"Info\"}"
else
  echo "{\"icon\":\"headphones\", \"text\": $n, \"state\": \"Info\"}"
fi
